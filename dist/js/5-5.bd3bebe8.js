(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{554:function(e,t,n){},555:function(e,t,n){e.exports={style:"_3hdTa_mbj1YVzvDPW6_xfe"}},560:function(e,t,n){"use strict";n(42);var u=n(10),f=(n(83),n(40)),i=(n(96),n(53)),c=(n(48),n(20)),a=(n(561),n(573)),r=n(1),p=n.n(r),l=n(176),d=function(e){var t=e.onClick,n=e.text,a=e.children;return p.a.createElement("div",{onClick:t,className:"contextMenu-option"},a||n||"")},o=n(0),s=n.n(o),m=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();n(554);var h=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={visible:t.props.visible},t.menuRoot=p.a.createRef(),t.style={},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,r["Component"]),m(n,[{key:"componentDidMount",value:function(){this.getMenuPosition(),document.addEventListener("click",this.props.closeMenu)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.props.closeMenu)}},{key:"componentDidUpdate",value:function(){this.getMenuPosition()}},{key:"getMenuPosition",value:function(){var e=this.menuRoot.current,t=this.props,n=t.clickX,a=t.clickY,r=window.innerWidth,o=window.innerHeight,i=e.offsetWidth,c=e.offsetHeight,l=i<r-n,s=!l,u=c<o-a,f=!u;l&&(e.style.left=n+"px"),s&&(e.style.left=n-i+"px"),u&&(e.style.top=a+"px"),f&&(e.style.top=a-c+"px")}},{key:"render",value:function(){return p.a.createElement("div",{ref:this.menuRoot,style:this.style,className:"contextMenu-wrap"},this.props.children)}}]),n}();h.propTypes={visible:s.a.bool.isRequired,closeMenu:s.a.func.isRequired,children:s.a.arrayOf(s.a.instanceOf(d))};var y=h,v=n(555),g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},b=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var E=a.a.DirectoryTree,_=a.a.TreeNode,C=function(e){function o(){var e,t,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=s=k(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(a)))).state={tree:s.props.data,rightClickItemInfo:{key:"all",isLeaf:!1},selectedKey:"all"},s.onSelect=function(e,t){var n=e[0];n!==s.state.selectedKey&&s.setState({selectedKey:n},function(){return s.props.getList(s.state.selectedKey)})},s.onConfirm=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"add",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=arguments[2],a=t,r=function(e){a=e.target.value},o={okText:"保存",cancelText:"取消",iconType:"pushpin"};switch(e){case"add":o.content=p.a.createElement(c.a,{defaultValue:t,onChange:function(e){return r(e)},placeholder:"请输入分类名"}),o.onOk=function(){return s.onAdd(a,n)},o.title="添加分类";break;case"rename":o.content=p.a.createElement(c.a,{defaultValue:t,onChange:function(e){return r(e)},placeholder:"请输入分类名"}),o.onOk=function(){s.onEdit("rename",a)},o.title="类目重命名",o.iconType="edit";break;case"delete":o.content=p.a.createElement("p",null,"删除后，该类目及其子类目都见被移除，是否确认删除！"),o.onOk=function(){return s.onEdit()},o.title="类目删除",o.okText="删除",o.okType="danger",o.iconType="delete"}i.a.confirm(o)},s.onAdd=function(e,t){var n=s.state,a=n.rightClickItemInfo,r=n.tree,o=a.parentId,i=t||a.key,c={};("all"===i?(c.name=e,s.hasSameName(e,!1)):(c={key:i,name:e,parentId:o},s.hasSameName(e)))?f.a.error("该类别已经存在"):s.props.addClass(g({},c)).then(function(t){var e="all"===i?r.concat(t.data):r.map(function(e){return e._id===o&&e.leaf.push(t.data),e});s.setState({tree:e}),f.a.success(t.msg)})},s.onEdit=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"delete",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=s.state,a=n.rightClickItemInfo,r=n.tree,o=a.key,i=a.parentId,c=a.isLeaf,l=r;if("rename"===e){if(s.hasSameName(t,c))return void f.a.info("该名称已经存在，请重新命名");s.props.putClass({key:o,name:t,parentId:i}).then(function(e){l=c?r.map(function(e){return e._id==i&&e.leaf.forEach(function(e){e._id!=o||(e.name=t)}),e}):r.map(function(e){return e._id==o&&(e.name=t),e}),s.setState({tree:l}),f.a.success(e.msg)})}else s.props.deleteClass({key:o,parentId:i}).then(function(e){l=c?r.map(function(e){return e._id==i&&(e.leaf=e.leaf.filter(function(e){return e._id!=o})),e}):r.filter(function(e){return e._id!=o}),s.setState({tree:l}),f.a.success(e.msg)})},s.hasSameName=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=s.state.rightClickItemInfo.parentId,a=s.state.tree,r=!1;return e?a.forEach(function(e){e._id!=n||(r=0<e.leaf.filter(function(e){return e.name===t}).length)}):r=0<a.filter(function(e){return e.name===t}).length,r},s.getMenuName=function(e){var t=s.state.tree,n=e.isLeaf,a=e.parentId,r=e.key,o="";return t.forEach(function(e){n&&e._id==a?e.leaf.forEach(function(e){e._id!=r||(o=e.name)}):e._id!=r||(o=e.name)}),o},s.handleRightClick=function(e){var n="all",t=!1,a="";if(l.a.get(e,"node.props")){var r=e.node.props.eventKey;if("all"===r)return void f.a.warn("根目录不可编辑");n=r,(t=e.node.props.isLeaf||!1)?s.state.tree.forEach(function(t){t.leaf.forEach(function(e){e._id===n&&(a=t._id)})}):a=n}s.setState({clickX:e.event.clientX,clickY:e.event.clientY,rightClickItemInfo:{key:n,parentId:a,isLeaf:t},visible:!0})},s.closeMenu=function(){s.setState({visible:!1})},k(s,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,r["PureComponent"]),b(o,[{key:"render",value:function(){var t=this,e=this.state,n=e.tree,a=e.visible,r=e.clickX,o=e.clickY,i=e.rightClickItemInfo,c=this.props,l=c.name,s=c.title;return p.a.createElement("div",{className:v.style},s,p.a.createElement(E,{defaultExpandParent:!0,defaultExpandedKeys:["all"],defaultSelectedKeys:["all"],onSelect:this.onSelect,onRightClick:function(e){return t.handleRightClick(e)}},"   ",p.a.createElement(_,{title:"全部"+l,key:"all"},n.map(function(e){return p.a.createElement(_,{title:e.name,key:e._id},e.leaf&&e.leaf.map(function(e){return p.a.createElement(_,{title:e.name,key:e._id,isLeaf:!0})}))}))),p.a.createElement("div",{className:"add-tree",onClick:function(){return t.onConfirm("add","","all")},title:"添加分类"},p.a.createElement(u.a,{type:"plus"})),a&&p.a.createElement(y,{clickY:o,visible:a,clickX:r,closeMenu:this.closeMenu},p.a.createElement(d,{text:"删除",onClick:function(){return t.onConfirm("delete")}}),p.a.createElement(d,{text:"编辑",onClick:function(){return t.onConfirm("rename",t.getMenuName(i))}}),p.a.createElement(d,{text:"添加",onClick:function(){return t.onConfirm("add")}}),p.a.createElement(d,{text:"取消"})))}}]),o}();C.defaultProps={name:"图片",title:p.a.createElement("p",{className:"title"},"类目管理")};t.a=C},642:function(e,t,n){e.exports={style:"_3b-1gnSQ_2ipjAaPklMvmX"}},648:function(e,t,n){"use strict";n.r(t);n(359);var l=n(177),s=(n(98),n(54)),u=(n(570),n(572)),f=(n(42),n(10)),a=n(1),p=n.n(a),r=n(17),d=n(92),o=n(140),i=n(99),m=n(560),h=n(642),c=n(29),y=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();function v(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var b=[{title:"宝贝图片",dataIndex:"images",className:"staff-td",render:function(e){return p.a.createElement("div",{className:"product-img"},p.a.createElement("img",{src:c.i+e[0]}))}},{title:"宝贝标题",dataIndex:"title",key:"title",className:"staff-td"},{title:"购买地址",dataIndex:"buyUrl",className:"staff-td",render:function(e){return p.a.createElement("a",{src:e},e)}},{title:"添加时间",dataIndex:"time",className:"staff-td",render:function(e){return Object(i.a)(e).fullTime}},{key:"_id",title:"操作",dataIndex:"_id",className:"staff-td",render:function(e){return p.a.createElement("div",{className:"action"},Object(o.b)("product_edit")&&p.a.createElement(r.Link,{to:"/product/edit/"+e,className:"outline-btn edit-a"},"编辑"),p.a.createElement(r.Link,{to:"/product/info/"+e,className:"btn-style search-a"},"查看"))}}],k=function(e){function o(){var e,t,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=f=g(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(a)))).state={visible:!0,classData:null,dataSource:[],status:0,pageSize:10,total:0,current:1},f.getProductList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"all",n=f.state,u=n.dataSource,a=n.pageSize,r=n.status;Object(d.f)({page:e,pageSize:a,typeClass:t,status:r}).then(function(e){var t,n,a=e.data,r=a.data,o=a.pageConfig,i=o.total,c=o.current,l=o.pageSize,s=void 0;u.length!=i?(t=s=new Array(i)).splice.apply(t,[(c-1)*l,l].concat(v(r))):(n=s=u.slice()).splice.apply(n,[(c-1)*l,l].concat(v(r)));f.setState({dataSource:s,total:i,current:c,pageSize:l})})},f.onChangeStatus=function(e){f.setState({status:+e},f.getProductList)},f.onPageChange=function(e,t){f.state.dataSource[(e-1)*t]?f.setState({current:e}):f.getProductList(e)},f.getProductClass=function(){Object(d.d)().then(function(e){f.setState({classData:e.data,visible:!1})})},g(f,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,a["PureComponent"]),y(o,[{key:"componentDidMount",value:function(){Promise.all([this.getProductClass(),this.getProductList()])}},{key:"render",value:function(){var t=this,e=this.state,n=e.classData,a=e.visible,r=e.dataSource,o=e.current,i=e.total,c=e.pageSize;return p.a.createElement("div",{className:h.style},p.a.createElement(u.a,{defaultActiveKey:"0",onChange:this.onChangeStatus},p.a.createElement(u.a.TabPane,{tab:p.a.createElement("span",null,p.a.createElement(f.a,{type:"inbox"}),"仓库宝贝"),key:"0"}),p.a.createElement(u.a.TabPane,{tab:p.a.createElement("span",null,p.a.createElement(f.a,{type:"shop"}),"在架宝贝"),key:"1"})),p.a.createElement("div",{className:"container"},p.a.createElement(s.a,{spinning:a},p.a.createElement("aside",null,n&&p.a.createElement(m.a,{name:"宝贝",data:n,addClass:d.b,putClass:d.g,deleteClass:d.c,getList:function(e){return t.getProductList(1,e)}}))),p.a.createElement("div",{className:"content"},p.a.createElement(l.a,{rowKey:"_id",dataSource:r,columns:b,pagination:{current:o,total:i,pageSize:c,onChange:this.onPageChange,hideOnSinglePage:!0}}))))}}]),o}();t.default=k}}]);